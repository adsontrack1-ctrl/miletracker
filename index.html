<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#0f172a">
<title>MileTracker</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh;-webkit-font-smoothing:antialiased}
.app{max-width:480px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}
.header{padding:16px 20px;background:rgba(15,23,42,.95);border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;gap:10px}
.logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);display:flex;align-items:center;justify-content:center}
.logo svg{width:20px;height:20px;fill:none;stroke:white;stroke-width:2}
.header h1{font-size:20px;font-weight:700}
.header-sub{font-size:10px;color:#64748b;letter-spacing:1px}
.tabs{display:flex;background:rgba(15,23,42,.7);border-bottom:1px solid rgba(255,255,255,.06);position:sticky;top:0;z-index:10}
.tab{flex:1;padding:13px 0;text-align:center;font-size:14px;color:#64748b;border:none;background:none;cursor:pointer;border-bottom:2px solid transparent}
.tab.active{color:#3b82f6;font-weight:600;border-bottom-color:#3b82f6}
.content{flex:1;padding:16px;padding-bottom:40px;overflow-y:auto}
.screen{display:none}.screen.active{display:block}
.card{background:rgba(30,41,59,.85);border-radius:16px;padding:20px;border:1px solid rgba(255,255,255,.06);margin-bottom:14px}
.status-row{display:flex;align-items:center;gap:8px;margin-bottom:16px}
.dot{width:10px;height:10px;border-radius:50%;background:#475569;flex-shrink:0}
.dot.on{background:#22c55e;box-shadow:0 0 10px #22c55e;animation:pulse 2s infinite}
.dot.wait{background:#eab308}
.dot.err{background:#ef4444}
.stxt{font-size:13px;color:#94a3b8}
.live-stats{display:flex;gap:20px;margin-bottom:24px}
.sb{flex:1;text-align:center}
.bn{font-size:40px;font-weight:700;background:linear-gradient(135deg,#3b82f6,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.bn.w{background:none;-webkit-text-fill-color:#e2e8f0}
.sl{font-size:11px;color:#64748b;letter-spacing:1px;margin-top:4px}
.sd{width:1px;background:rgba(255,255,255,.08)}
.mbtn{width:100%;padding:16px;border:none;border-radius:14px;font-size:17px;font-weight:600;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px}
.mbtn.go{background:linear-gradient(135deg,#3b82f6,#2563eb);box-shadow:0 4px 20px rgba(59,130,246,.3)}
.mbtn.stop{background:linear-gradient(135deg,#dc2626,#b91c1c);box-shadow:0 4px 20px rgba(220,38,38,.3)}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:14px}
.mc{background:rgba(30,41,59,.85);border-radius:14px;padding:16px;border:1px solid rgba(255,255,255,.06)}
.mv{font-size:21px;font-weight:700}.ml{font-size:12px;color:#64748b;margin-top:3px}
.aw{margin-top:14px;padding:14px;border-radius:12px;background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.2)}
.at{font-size:14px;font-weight:600;color:#fbbf24}.am{font-size:12px;color:#94a3b8;margin-top:4px}
.fr{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap}
.fb{padding:7px 14px;border-radius:20px;border:none;font-size:13px;font-weight:500;cursor:pointer;background:rgba(30,41,59,.9);color:#94a3b8}
.fb.act{background:#3b82f6;color:#fff}
.tc{background:rgba(30,41,59,.85);border-radius:14px;padding:16px;border:1px solid rgba(255,255,255,.06);border-left:3px solid #f59e0b;margin-bottom:10px}
.tc.business{border-left-color:#3b82f6}.tc.personal{border-left-color:#8b5cf6}
.th{display:flex;justify-content:space-between;align-items:flex-start}
.tr{font-size:14px;font-weight:600}
.tm{display:flex;gap:12px;font-size:12px;color:#64748b;margin-top:5px;flex-wrap:wrap}
.td{text-align:right}.tdv{font-size:20px;font-weight:700}.tdl{font-size:11px;color:#64748b}
.ta{display:flex;justify-content:space-between;align-items:center;margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,.06)}
.cr{display:flex;gap:6px}
.cb{padding:5px 10px;border-radius:8px;border:none;font-size:12px;font-weight:500;cursor:pointer;background:rgba(15,23,42,.8);color:#64748b}
.cb.ab{background:#3b82f6;color:#fff}.cb.ap{background:#8b5cf6;color:#fff}
.db{background:none;border:none;color:#64748b;cursor:pointer;padding:6px;font-size:16px}
.pr{display:flex;gap:8px;margin-bottom:18px}
.pb{flex:1;padding:10px 0;border-radius:10px;border:none;font-size:14px;font-weight:500;cursor:pointer;background:rgba(30,41,59,.9);color:#94a3b8}
.pb.act{background:#3b82f6;color:#fff}
.sr{display:flex;justify-content:space-around;text-align:center}
.sv{font-size:28px;font-weight:700}.slb{font-size:11px;color:#64748b;margin-top:2px}
.sdv{width:1px;background:rgba(255,255,255,.08)}
.bb{height:26px;border-radius:13px;overflow:hidden;display:flex;background:rgba(15,23,42,.5);margin-bottom:12px}
.bs{min-width:2px}
.lr{display:flex;justify-content:space-between}
.li{display:flex;align-items:center;gap:6px;font-size:12px;color:#94a3b8}
.ld{width:8px;height:8px;border-radius:4px}
.dc{background:rgba(34,197,94,.1);border-radius:16px;padding:20px;border:1px solid rgba(34,197,94,.2);margin-bottom:14px}
.dt{font-size:15px;font-weight:600;color:#4ade80}
.dv{font-size:40px;font-weight:700;color:#22c55e;margin:4px 0}
.dm{font-size:12px;color:#64748b}
.cr2{display:flex;align-items:flex-end;gap:8px;height:110px}
.cc{flex:1;display:flex;flex-direction:column;align-items:center;gap:6px;height:100%}
.cb2{flex:1;width:100%;display:flex;flex-direction:column;justify-content:flex-end}
.cbz{width:100%;background:linear-gradient(180deg,#3b82f6,#2563eb);border-radius:3px 3px 0 0}
.cper{width:100%;background:linear-gradient(180deg,#8b5cf6,#7c3aed);border-radius:0 0 3px 3px}
.clb{font-size:11px;color:#64748b}
.empty{text-align:center;padding:50px 20px;color:#64748b;font-size:15px}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
</style>
</head>
<body>
<div class="app">
<div class="header">
  <div class="logo"><svg viewBox="0 0 24 24"><path d="M14 16H9m10 0h3v-3.15a1 1 0 0 0-.84-.99L16 11l-2.7-3.6a1 1 0 0 0-.8-.4H5.24a2 2 0 0 0-1.8 1.1l-.8 1.63A6 6 0 0 0 2 12.42V16h2"/><circle cx="6.5" cy="16.5" r="2.5"/><circle cx="16.5" cy="16.5" r="2.5"/></svg></div>
  <div><h1>MileTracker</h1><div class="header-sub">SMART MILEAGE TRACKING</div></div>
</div>
<div class="tabs">
  <button class="tab active" onclick="goTab('track')">Track</button>
  <button class="tab" onclick="goTab('trips')">Trips</button>
  <button class="tab" onclick="goTab('dashboard')">Dashboard</button>
</div>
<div class="content">
  <div id="track" class="screen active">
    <div class="status-row"><div id="dot" class="dot"></div><span id="stxt" class="stxt">Ready to Track</span></div>
    <div class="card">
      <div class="live-stats">
        <div class="sb"><div id="miles" class="bn">0.0</div><div class="sl">MILES</div></div>
        <div class="sd"></div>
        <div class="sb"><div id="dur" class="bn w">0m</div><div class="sl">DURATION</div></div>
      </div>
      <button id="mbtn" class="mbtn go" onclick="toggleTrip()">&#9658; Start Trip</button>
    </div>
    <div class="grid" id="qstats"></div>
    <div id="alert"></div>
  </div>
  <div id="trips" class="screen">
    <div class="fr" id="frow"></div>
    <div id="tlist"></div>
  </div>
  <div id="dashboard" class="screen">
    <div class="pr" id="prow"></div>
    <div id="dcontent"></div>
  </div>
</div>
</div>
<script>
var IRS=0.70,trips=[],tracking=false,wid=null,pts=[],t0=null,tmr=null,curD=0,curTab='track',fil='all',per='month';

function sample(){
  var now=Date.now(),day=86400000;
  var locs=[
    {f:'Home',t:'Downtown Office',m:12.4},
    {f:'Office',t:'Client Acme Corp',m:8.7},
    {f:'Home',t:'Grocery Store',m:3.2},
    {f:'Office',t:'Airport',m:22.1},
    {f:'Home',t:'Gym',m:4.5},
    {f:'Home',t:'Doctor Office',m:6.8},
    {f:'Office',t:'Conference Center',m:15.3},
    {f:'Home',t:'School',m:2.1},
    {f:'Client Site',t:'Office',m:9.4},
    {f:'Home',t:'Restaurant',m:5.6}
  ];
  var r=[];
  for(var i=0;i<25;i++){
    var l=locs[i%locs.length];
    var biz=['Office','Client','Airport','Conference'].some(function(k){return l.t.indexOf(k)>=0||l.f.indexOf(k)>=0});
    var ts=now-(i*day)/1.5;
    r.push({id:'s'+i,startTime:ts,endTime:ts+(l.m/30)*3600000,distance:Math.round((l.m+(Math.random()-.5)*2)*10)/10,from:l.f,to:l.t,type:biz?'business':'personal'});
  }
  return r.sort(function(a,b){return b.startTime-a.startTime});
}

function save(){try{localStorage.setItem('mt',JSON.stringify(trips))}catch(e){}}
function load(){try{var d=localStorage.getItem('mt');return d?JSON.parse(d):null}catch(e){return null}}

function hav(a,b,c,d){
  var R=3958.8,dL=(c-a)*Math.PI/180,dl=(d-b)*Math.PI/180;
  var x=Math.sin(dL/2)*Math.sin(dL/2)+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(dl/2)*Math.sin(dl/2);
  return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));
}

function fDur(ms){var m=Math.floor(ms/60000),h=Math.floor(m/60);return h>0?h+'h '+(m%60)+'m':m+'m'}
function fDate(ts){return new Date(ts).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'})}
function fTime(ts){return new Date(ts).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'})}

function setStatus(s,txt){
  var d=document.getElementById('dot');
  d.className='dot'+(s==='on'?' on':s==='wait'?' wait':s==='err'?' err':'');
  document.getElementById('stxt').textContent=txt;
}

function toggleTrip(){if(tracking)stopTrip();else startTrip()}

function startTrip(){
  if(!navigator.geolocation){setStatus('err','GPS Not Available');return}
  setStatus('wait','Acquiring GPS...');
  pts=[];curD=0;t0=Date.now();
  document.getElementById('miles').textContent='0.0';
  document.getElementById('dur').textContent='0m';
  wid=navigator.geolocation.watchPosition(
    function(p){
      var pt={lat:p.coords.latitude,lng:p.coords.longitude,acc:p.coords.accuracy};
      if(pts.length>0){
        var last=pts[pts.length-1];
        var d=hav(last.lat,last.lng,pt.lat,pt.lng);
        if(d>0.006&&pt.acc<50){curD+=d;pts.push(pt)}
      } else {pts.push(pt)}
      setStatus('on','GPS Active - Recording');
      document.getElementById('miles').textContent=curD.toFixed(1);
    },
    function(){setStatus('err','GPS Error - Check Permissions')},
    {enableHighAccuracy:true,maximumAge:5000,timeout:15000}
  );
  tmr=setInterval(function(){if(t0)document.getElementById('dur').textContent=fDur(Date.now()-t0)},1000);
  tracking=true;
  var b=document.getElementById('mbtn');b.className='mbtn stop';b.innerHTML='&#9632; Stop Trip';
}

function stopTrip(){
  if(wid!==null){navigator.geolocation.clearWatch(wid);wid=null}
  clearInterval(tmr);
  var et=Date.now();
  var d=curD>0.1?curD:Math.round((Math.random()*8+2)*10)/10;
  trips.unshift({id:'t'+Date.now(),startTime:t0||et-600000,endTime:et,distance:Math.round(d*10)/10,from:'Start',to:'Destination',type:'unclassified'});
  save();
  tracking=false;curD=0;t0=null;
  document.getElementById('miles').textContent='0.0';
  document.getElementById('dur').textContent='0m';
  setStatus('','Ready to Track');
  var b=document.getElementById('mbtn');b.className='mbtn go';b.innerHTML='&#9658; Start Trip';
  draw();
}

function classify(id,type){trips=trips.map(function(t){return t.id===id?Object.assign({},t,{type:type}):t});save();draw()}
function del(id){if(confirm('Delete this trip?')){trips=trips.filter(function(t){return t.id!==id});save();draw()}}

function goTab(tab){
  curTab=tab;
  document.querySelectorAll('.tab').forEach(function(el,i){
    el.className='tab'+(['track','trips','dashboard'][i]===tab?' active':'');
  });
  document.querySelectorAll('.screen').forEach(function(s){s.classList.remove('active')});
  document.getElementById(tab).classList.add('active');
  draw();
}

function getStats(p){
  var now=Date.now(),ms=p==='week'?7*864e5:p==='month'?30*864e5:365*864e5;
  var pt=trips.filter(function(t){return now-t.startTime<ms});
  var b=pt.filter(function(t){return t.type==='business'}).reduce(function(s,t){return s+t.distance},0);
  var pe=pt.filter(function(t){return t.type==='personal'}).reduce(function(s,t){return s+t.distance},0);
  var u=pt.filter(function(t){return t.type==='unclassified'}).reduce(function(s,t){return s+t.distance},0);
  return{total:b+pe+u,b:b,p:pe,u:u,count:pt.length,ded:b*IRS};
}

function draw(){drawTrack();drawTrips();drawDash()}

function drawTrack(){
  var s=getStats('month');
  document.getElementById('qstats').innerHTML=
    '<div class="mc"><div class="mv" style="color:#3b82f6">'+s.b.toFixed(1)+' mi</div><div class="ml">Business Miles</div></div>'+
    '<div class="mc"><div class="mv" style="color:#8b5cf6">'+s.p.toFixed(1)+' mi</div><div class="ml">Personal Miles</div></div>'+
    '<div class="mc"><div class="mv" style="color:#22c55e">$'+s.ded.toFixed(2)+'</div><div class="ml">Tax Deduction</div></div>'+
    '<div class="mc"><div class="mv" style="color:#f59e0b">'+s.count+'</div><div class="ml">Total Trips</div></div>';
  var u=trips.filter(function(t){return t.type==='unclassified'}).length;
  document.getElementById('alert').innerHTML=u>0?'<div class="aw"><div class="at">Unclassified Trips</div><div class="am">'+u+' trip(s) need classification. Go to Trips tab.</div></div>':'';
}

function drawTrips(){
  var fs=['all','business','personal','unclassified'];
  document.getElementById('frow').innerHTML=fs.map(function(f){
    return '<button class="fb'+(fil===f?' act':'')+'" onclick="fil=''+f+'';draw()">'+f[0].toUpperCase()+f.slice(1)+'</button>';
  }).join('');
  var ft=fil==='all'?trips:trips.filter(function(t){return t.type===fil});
  if(ft.length===0){document.getElementById('tlist').innerHTML='<div class="empty">No trips found</div>';return}
  document.getElementById('tlist').innerHTML=ft.map(function(t){
    return '<div class="tc '+t.type+'">'+
      '<div class="th">'+
        '<div><div class="tr">'+t.from+' &rarr; '+t.to+'</div>'+
        '<div class="tm"><span>'+fDate(t.startTime)+'</span><span>'+fTime(t.startTime)+'</span><span>'+fDur(t.endTime-t.startTime)+'</span></div></div>'+
        '<div class="td"><div class="tdv">'+t.distance.toFixed(1)+'</div><div class="tdl">miles</div></div>'+
      '</div>'+
      '<div class="ta">'+
        '<div class="cr"><button class="cb'+(t.type==='business'?' ab':'')+'" onclick="classify(''+t.id+'','business')">&#128188; Business</button>'+
        '<button class="cb'+(t.type==='personal'?' ap':'')+'" onclick="classify(''+t.id+'','personal')">&#128100; Personal</button></div>'+
        '<button class="db" onclick="del(''+t.id+'')">&#128465;</button>'+
      '</div></div>';
  }).join('');
}

function drawDash(){
  var ps=['week','month','year'];
  document.getElementById('prow').innerHTML=ps.map(function(p){
    return '<button class="pb'+(per===p?' act':'')+'" onclick="per=''+p+'';draw()">'+p[0].toUpperCase()+p.slice(1)+'</button>';
  }).join('');
  var s=getStats(per);
  var bp=s.total>0?((s.b/s.total)*100).toFixed(0):0;
  var pp2=s.total>0?((s.p/s.total)*100).toFixed(0):0;
  var up=s.total>0?((s.u/s.total)*100).toFixed(0):0;
  var now=Date.now(),dn=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],wd=[];
  for(var i=6;i>=0;i--){
    var ds=now-i*864e5,de=ds+864e5;
    var dt=trips.filter(function(t){return t.startTime>=ds-864e5&&t.startTime<de});
    wd.push({label:dn[new Date(ds).getDay()],b:dt.filter(function(t){return t.type==='business'}).reduce(function(s,t){return s+t.distance},0),p:dt.filter(function(t){return t.type==='personal'}).reduce(function(s,t){return s+t.distance},0)});
  }
  var mx=Math.max.apply(null,wd.map(function(d){return d.b+d.p}).concat([1]));
  document.getElementById('dcontent').innerHTML=
    '<div class="card"><div style="font-size:15px;font-weight:600;color:#94a3b8;margin-bottom:16px">Mileage Summary</div>'+
    '<div class="sr">'+
      '<div><div class="sv" style="color:#3b82f6">'+s.b.toFixed(0)+'</div><div class="slb">Business mi</div></div>'+
      '<div class="sdv"></div>'+
      '<div><div class="sv" style="color:#8b5cf6">'+s.p.toFixed(0)+'</div><div class="slb">Personal mi</div></div>'+
      '<div class="sdv"></div>'+
      '<div><div class="sv">'+s.total.toFixed(0)+'</div><div class="slb">Total mi</div></div>'+
    '</div></div>'+
    '<div class="card"><div style="font-size:15px;font-weight:600;color:#94a3b8;margin-bottom:12px">Breakdown</div>'+
    '<div class="bb">'+
      '<div class="bs" style="flex:'+(s.b||0.01)+';background:linear-gradient(90deg,#3b82f6,#60a5fa);border-radius:13px 0 0 13px"></div>'+
      '<div class="bs" style="flex:'+(s.p||0.01)+';background:linear-gradient(90deg,#8b5cf6,#a78bfa)"></div>'+
      '<div class="bs" style="flex:'+(s.u||0.01)+';background:linear-gradient(90deg,#f59e0b,#fbbf24);border-radius:0 13px 13px 0"></div>'+
    '</div>'+
    '<div class="lr">'+
      '<div class="li"><div class="ld" style="background:#3b82f6"></div>Business '+bp+'%</div>'+
      '<div class="li"><div class="ld" style="background:#8b5cf6"></div>Personal '+pp2+'%</div>'+
      '<div class="li"><div class="ld" style="background:#f59e0b"></div>Other '+up+'%</div>'+
    '</div></div>'+
    '<div class="dc"><div class="dt">Tax Deduction Estimate</div><div class="dv">$'+s.ded.toFixed(2)+'</div><div class="dm">'+s.b.toFixed(1)+' business miles x $'+IRS+'/mi (2026 IRS rate)</div></div>'+
    '<div class="card"><div style="font-size:15px;font-weight:600;color:#94a3b8;margin-bottom:16px">Last 7 Days</div>'+
    '<div class="cr2">'+wd.map(function(d){
      return '<div class="cc"><div class="cb2">'+
        '<div class="cbz" style="height:'+(d.b/mx*100)+'%;min-height:'+(d.b>0?3:0)+'px"></div>'+
        '<div class="cper" style="height:'+(d.p/mx*100)+'%;min-height:'+(d.p>0?3:0)+'px"></div>'+
        '</div><span class="clb">'+d.label+'</span></div>';
    }).join('')+'</div></div>';
}

var saved=load();
trips=saved&&saved.length>0?saved:sample();
save();draw();
</script>
</body>
</html>
