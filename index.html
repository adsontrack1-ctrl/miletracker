<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f172a">
<title>MileTracker</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; color: #e2e8f0; min-height: 100vh; overflow-x: hidden; -webkit-font-smoothing: antialiased; }
  .app { max-width: 480px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; }
  .header { padding: 16px 20px; background: rgba(15,23,42,0.95); border-bottom: 1px solid rgba(255,255,255,0.06); display: flex; align-items: center; gap: 10px; }
  .logo { width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); display: flex; align-items: center; justify-content: center; }
  .logo svg { width: 20px; height: 20px; fill: none; stroke: white; stroke-width: 2; }
  .header h1 { font-size: 20px; font-weight: 700; }
  .header-sub { font-size: 10px; color: #64748b; letter-spacing: 1px; }
  .tabs { display: flex; background: rgba(15,23,42,0.7); border-bottom: 1px solid rgba(255,255,255,0.06); position: sticky; top: 0; z-index: 10; }
  .tab { flex: 1; padding: 13px 0; text-align: center; font-size: 14px; color: #64748b; border: none; background: none; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; }
  .tab.active { color: #3b82f6; font-weight: 600; border-bottom-color: #3b82f6; }
  .content { flex: 1; padding: 16px; padding-bottom: 40px; overflow-y: auto; }
  .screen { display: none; }
  .screen.active { display: block; }
  .card { background: rgba(30,41,59,0.85); border-radius: 16px; padding: 20px; border: 1px solid rgba(255,255,255,0.06); margin-bottom: 14px; }
  .status-row { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; }
  .status-dot { width: 10px; height: 10px; border-radius: 50%; background: #475569; flex-shrink: 0; }
  .status-dot.tracking { background: #22c55e; box-shadow: 0 0 10px #22c55e; animation: pulse 2s infinite; }
  .status-dot.acquiring { background: #eab308; }
  .status-dot.error { background: #ef4444; }
  .status-text { font-size: 13px; color: #94a3b8; }
  .live-stats { display: flex; gap: 20px; margin-bottom: 24px; }
  .stat-block { flex: 1; text-align: center; }
  .big-num { font-size: 40px; font-weight: 700; background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  .big-num.white { background: none; -webkit-text-fill-color: #e2e8f0; }
  .stat-label { font-size: 11px; color: #64748b; letter-spacing: 1px; margin-top: 4px; }
  .stat-divider { width: 1px; background: rgba(255,255,255,0.08); }
  .speed-row { text-align: center; margin-bottom: 16px; }
  .main-btn { width: 100%; padding: 16px; border: none; border-radius: 14px; font-size: 17px; font-weight: 600; color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: all 0.3s; }
  .main-btn.start { background: linear-gradient(135deg, #3b82f6, #2563eb); box-shadow: 0 4px 20px rgba(59,130,246,0.3); }
  .main-btn.stop { background: linear-gradient(135deg, #dc2626, #b91c1c); box-shadow: 0 4px 20px rgba(220,38,38,0.3); }
  .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .mini-card { background: rgba(30,41,59,0.85); border-radius: 14px; padding: 16px; border: 1px solid rgba(255,255,255,0.06); }
  .mini-val { font-size: 21px; font-weight: 700; }
  .mini-label { font-size: 12px; color: #64748b; margin-top: 3px; }
  .alert-card { margin-top: 14px; padding: 14px; border-radius: 12px; background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.2); }
  .alert-title { font-size: 14px; font-weight: 600; color: #fbbf24; }
  .alert-text { font-size: 12px; color: #94a3b8; margin-top: 4px; }
  .filter-row { display: flex; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; }
  .filter-btn { padding: 7px 14px; border-radius: 20px; border: none; font-size: 13px; font-weight: 500; cursor: pointer; background: rgba(30,41,59,0.9); color: #94a3b8; }
  .filter-btn.active { background: #3b82f6; color: #fff; }
  .trip-card { background: rgba(30,41,59,0.85); border-radius: 14px; padding: 16px; border: 1px solid rgba(255,255,255,0.06); border-left: 3px solid #f59e0b; margin-bottom: 10px; }
  .trip-card.business { border-left-color: #3b82f6; }
  .trip-card.personal { border-left-color: #8b5cf6; }
  .trip-header { display: flex; justify-content: space-between; align-items: flex-start; }
  .trip-route { font-size: 14px; font-weight: 600; }
  .trip-meta { display: flex; gap: 12px; font-size: 12px; color: #64748b; margin-top: 5px; flex-wrap: wrap; }
  .trip-dist { text-align: right; }
  .trip-dist-val { font-size: 20px; font-weight: 700; }
  .trip-dist-label { font-size: 11px; color: #64748b; }
  .trip-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.06); }
  .classify-row { display: flex; gap: 6px; }
  .classify-btn { padding: 5px 10px; border-radius: 8px; border: none; font-size: 12px; font-weight: 500; cursor: pointer; background: rgba(15,23,42,0.8); color: #64748b; }
  .classify-btn.active-biz { background: #3b82f6; color: #fff; }
  .classify-btn.active-per { background: #8b5cf6; color: #fff; }
  .delete-btn { background: none; border: none; color: #64748b; cursor: pointer; padding: 6px; font-size: 16px; }
  .period-row { display: flex; gap: 8px; margin-bottom: 18px; }
  .period-btn { flex: 1; padding: 10px 0; border-radius: 10px; border: none; font-size: 14px; font-weight: 500; cursor: pointer; background: rgba(30,41,59,0.9); color: #94a3b8; }
  .period-btn.active { background: #3b82f6; color: #fff; }
  .summary-row { display: flex; justify-content: space-around; text-align: center; }
  .summary-val { font-size: 28px; font-weight: 700; }
  .summary-label { font-size: 11px; color: #64748b; margin-top: 2px; }
  .summary-div { width: 1px; background: rgba(255,255,255,0.08); }
  .breakdown-bar { height: 26px; border-radius: 13px; overflow: hidden; display: flex; background: rgba(15,23,42,0.5); margin-bottom: 12px; }
  .bar-seg { min-width: 2px; }
  .legend-row { display: flex; justify-content: space-between; }
  .legend-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: #94a3b8; }
  .legend-dot { width: 8px; height: 8px; border-radius: 4px; }
  .deduction-card { background: rgba(34,197,94,0.1); border-radius: 16px; padding: 20px; border: 1px solid rgba(34,197,94,0.2); margin-bottom: 14px; }
  .deduction-title { font-size: 15px; font-weight: 600; color: #4ade80; }
  .deduction-value { font-size: 40px; font-weight: 700; color: #22c55e; margin: 4px 0; }
  .deduction-meta { font-size: 12px; color: #64748b; }
  .chart-row { display: flex; align-items: flex-end; gap: 8px; height: 110px; }
  .chart-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 6px; height: 100%; }
  .chart-bars { flex: 1; width: 100%; display: flex; flex-direction: column; justify-content: flex-end; }
  .chart-bar-biz { width: 100%; background: linear-gradient(180deg, #3b82f6, #2563eb); border-radius: 3px 3px 0 0; }
  .chart-bar-per { width: 100%; background: linear-gradient(180deg, #8b5cf6, #7c3aed); border-radius: 0 0 3px 3px; }
  .chart-label { font-size: 11px; color: #64748b; }
  .empty { text-align: center; padding: 50px 20px; color: #64748b; font-size: 15px; }
  @keyframes pulse { 0%,100%{opacity:1}50%{opacity:0.4} }
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="logo"><svg viewBox="0 0 24 24"><path d="M14 16H9m10 0h3v-3.15a1 1 0 0 0-.84-.99L16 11l-2.7-3.6a1 1 0 0 0-.8-.4H5.24a2 2 0 0 0-1.8 1.1l-.8 1.63A6 6 0 0 0 2 12.42V16h2"/><circle cx="6.5" cy="16.5" r="2.5"/><circle cx="16.5" cy="16.5" r="2.5"/></svg></div>
    <div><h1>MileTracker</h1><div class="header-sub">SMART MILEAGE TRACKING</div></div>
  </div>
  <div class="tabs">
    <button class="tab active" onclick="switchTab('track')">Track</button>
    <button class="tab" onclick="switchTab('trips')">Trips</button>
    <button class="tab" onclick="switchTab('dashboard')">Dashboard</button>
  </div>
  <div class="content">
    <div id="screen-track" class="screen active">
      <div class="status-row"><div id="status-dot" class="status-dot"></div><span id="status-text" class="status-text">Ready to Track</span></div>
      <div class="card">
        <div class="live-stats">
          <div class="stat-block"><div id="live-distance" class="big-num">0.0</div><div class="stat-label">MILES</div></div>
          <div class="stat-divider"></div>
          <div class="stat-block"><div id="live-duration" class="big-num white">0m</div><div class="stat-label">DURATION</div></div>
        </div>
        <div id="speed-row" class="speed-row" style="display:none"><span id="live-speed" class="status-text">0 mph</span></div>
        <button id="main-btn" class="main-btn start" onclick="toggleTracking()">&#9658; Start Trip</button>
      </div>
      <div class="stats-grid" id="quick-stats"></div>
      <div id="unclassified-alert"></div>
    </div>
    <div id="screen-trips" class="screen"><div class="filter-row" id="filter-row"></div><div id="trip-list"></div></div>
    <div id="screen-dashboard" class="screen"><div class="period-row" id="period-row"></div><div id="dashboard-content"></div></div>
  </div>
</div>
<script>
const IRS=0.70;let trips=[],tracking=false,watchId=null,points=[],startTime=null,timer=null,dist=0,tab='track',fil='all',per='month';
function sampleTrips(){const now=Date.now(),d=86400000,locs=[{f:'Home',t:'Downtown Office',m:12.4},{f:'Office',t:'Client Acme Corp',m:8.7},{f:'Home',t:'Grocery Store',m:3.2},{f:'Office',t:'Airport',m:22.1},{f:'Home',t:'Gym',m:4.5},{f:'Home',t:"Doctor Office",m:6.8},{f:'Office',t:'Conference Center',m:15.3},{f:'Home',t:'School',m:2.1},{f:'Client Site',t:'Office',m:9.4},{f:'Home',t:'Restaurant',m:5.6}],r=[];for(let i=0;i<25;i++){const l=locs[i%locs.length],b=['Office','Client','Airport','Conference'].some(k=>l.t.includes(k)||l.f.includes(k)),ts=now-(i*d)/1.5;r.push({id:'s'+i,startTime:ts,endTime:ts+(l.m/30)*3600000,distance:+(l.m+(Math.random()-.5)*2).toFixed(1),startLocation:l.f,endLocation:l.t,type:b?'business':'personal'})}return r.sort((a,b)=>b.startTime-a.startTime)}
function save(){try{localStorage.setItem('mt',JSON.stringify(trips))}catch(e){}}
function load(){try{const d=localStorage.getItem('mt');return d?JSON.parse(d):null}catch(e){return null}}
function hav(a,b,c,d){const R=3958.8,dL=(c-a)*Math.PI/180,dl=(d-b)*Math.PI/180,x=Math.sin(dL/2)**2+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(dl/2)**2;return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x))}
function fDur(ms){const m=Math.floor(ms/60000),h=Math.floor(m/60);return h>0?h+'h '+(m%60)+'m':m+'m'}
function fDate(ts){return new Date(ts).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'})}
function fTime(ts){return new Date(ts).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'})}
function toggleTracking(){tracking?stopT():startT()}
function startT(){if(!navigator.geolocation){setS('error','GPS Not Available');return}setS('acquiring','Acquiring GPS...');points=[];dist=0;startTime=Date.now();document.getElementById('live-distance').textContent='0.0';watchId=navigator.geolocation.watchPosition(p=>{const pt={lat:p.coords.latitude,lng:p.coords.longitude,acc:p.coords.accuracy};if(points.length>0){const l=points[points.length-1],d=hav(l.lat,l.lng,pt.lat,pt.lng);if(d>0.006&&pt.acc<50){dist+=d;points.push(pt)}}else points.push(pt);setS('tracking','GPS Active - Recording');document.getElementById('live-distance').textContent=dist.toFixed(1);if(p.coords.speed>=0){document.getElementById('live-speed').textContent=(p.coords.speed*2.237).toFixed(0)+' mph';document.getElementById('speed-row').style.display=''}},e=>setS('error','GPS Error'),{enableHighAccuracy:true,maximumAge:5000,timeout:15000});timer=setInterval(()=>{if(startTime)document.getElementById('live-duration').textContent=fDur(Date.now()-startTime)},1000);tracking=true;const b=document.getElementById('main-btn');b.className='main-btn stop';b.innerHTML='&#9632; Stop Trip'}
function stopT(){if(watchId!==null){navigator.geolocation.clearWatch(watchId);watchId=null}clearInterval(timer);const et=Date.now(),d=dist>0.1?dist:+(Math.random()*8+2).toFixed(1);trips.unshift({id:'t'+Date.now(),startTime:startTime||et-600000,endTime:et,distance:+d.toFixed(1),startLocation:'Start',endLocation:'Destination',type:'unclassified'});save();tracking=false;dist=0;startTime=null;document.getElementById('live-distance').textContent='0.0';document.getElementById('live-duration').textContent='0m';document.getElementById('speed-row').style.display='none';setS('idle','Ready to Track');const b=document.getElementById('main-btn');b.className='main-btn start';b.innerHTML='&#9658; Start Trip';renderAll()}
function setS(state,text){document.getElementById('status-dot').className='status-dot'+(state==='tracking'?' tracking':state==='acquiring'?' acquiring':state==='error'?' error':'');document.getElementById('status-text').textContent=text}
function classify(id,type){trips=trips.map(t=>t.id===id?{...t,type}:t);save();renderAll()}
function del(id){if(confirm('Delete?')){trips=trips.filter(t=>t.id!==id);save();renderAll()}}
function switchTab(t){tab=t;document.querySelectorAll('.tab').forEach((x,i)=>{x.className='tab'+(['track','trips','dashboard'][i]===t?' active':'')});document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById('screen-'+t).classList.add('active');renderAll()}
function stats(p){const now=Date.now(),ms=p==='week'?7*864e5:p==='month'?30*864e5:365*864e5,pt=trips.filter(t=>now-t.startTime<ms),b=pt.filter(t=>t.type==='business').reduce((s,t)=>s+t.distance,0),pe=pt.filter(t=>t.type==='personal').reduce((s,t)=>s+t.distance,0),u=pt.filter(t=>t.type==='unclassified').reduce((s,t)=>s+t.distance,0);return{total:b+pe+u,business:b,personal:pe,unclassified:u,count:pt.length,deduction:b*IRS}}
function renderAll(){renderTrack();renderTrips();renderDash()}
function renderTrack(){const s=stats('month');document.getElementById('quick-stats').innerHTML='<div class="mini-card"><div class="mini-val" style="color:#3b82f6">'+s.business.toFixed(1)+' mi</div><div class="mini-label">Business Miles</div></div><div class="mini-card"><div class="mini-val" style="color:#8b5cf6">'+s.personal.toFixed(1)+' mi</div><div class="mini-label">Personal Miles</div></div><div class="mini-card"><div class="mini-val" style="color:#22c55e">$'+s.deduction.toFixed(2)+'</div><div class="mini-label">Tax Deduction</div></div><div class="mini-card"><div class="mini-val" style="color:#f59e0b">'+s.count+'</div><div class="mini-label">Total Trips</div></div>';const u=trips.filter(t=>t.type==='unclassified').length;document.getElementById('unclassified-alert').innerHTML=u>0?'<div class="alert-card"><div class="alert-title">Unclassified Trips</div><div class="alert-text">'+u+' trip(s) need classification. Go to Trips tab.</div></div>':''}
function renderTrips(){document.getElementById('filter-row').innerHTML=['all','business','personal','unclassified'].map(f=>'<button class="filter-btn'+(fil===f?' active':'')+'" onclick="fil=''+f+'';renderAll()">'+f[0].toUpperCase()+f.slice(1)+'</button>').join('');const ft=fil==='all'?trips:trips.filter(t=>t.type===fil);document.getElementById('trip-list').innerHTML=ft.length===0?'<div class="empty">No trips found</div>':ft.map(t=>'<div class="trip-card '+t.type+'"><div class="trip-header"><div><div class="trip-route">'+t.startLocation+' &rarr; '+t.endLocation+'</div><div class="trip-meta"><span>'+fDate(t.startTime)+'</span><span>'+fTime(t.startTime)+'</span><span>'+fDur(t.endTime-t.startTime)+'</span></div></div><div class="trip-dist"><div class="trip-dist-val">'+t.distance.toFixed(1)+'</div><div class="trip-dist-label">miles</div></div></div><div class="trip-actions"><div class="classify-row"><button class="classify-btn'+(t.type==='business'?' active-biz':'')+'" onclick="classify(''+t.id+'','business')">Business</button><button class="classify-btn'+(t.type==='personal'?' active-per':'')+'" onclick="classify(''+t.id+'','personal')">Personal</button></div><button class="delete-btn" onclick="del(''+t.id+'')">&#128465;</button></div></div>').join('')}
function renderDash(){document.getElementById('period-row').innerHTML=['week','month','year'].map(p=>'<button class="period-btn'+(per===p?' active':'')+'" onclick="per=''+p+'';renderAll()">'+p[0].toUpperCase()+p.slice(1)+'</button>').join('');const s=stats(per),bp=s.total>0?((s.business/s.total)*100).toFixed(0):0,pp=s.total>0?((s.personal/s.total)*100).toFixed(0):0,up=s.total>0?((s.unclassified/s.total)*100).toFixed(0):0,now=Date.now(),dn=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],wd=[];for(let i=6;i>=0;i--){const ds=now-i*864e5,de=ds+864e5,dt=trips.filter(t=>t.startTime>=ds-864e5&&t.startTime<de);wd.push({label:dn[new Date(ds).getDay()],b:dt.filter(t=>t.type==='business').reduce((s,t)=>s+t.distance,0),p:dt.filter(t=>t.type==='personal').reduce((s,t)=>s+t.distance,0)})}const mx=Math.max(...wd.map(d=>d.b+d.p),1);document.getElementById('dashboard-content').innerHTML='<div class="card"><div style="font-size:15px;font-weight:600;color:#94a3b8;margin-bottom:16px">Mileage Summary</div><div class="summary-row"><div><div class="summary-val" style="color:#3b82f6">'+s.business.toFixed(0)+'</div><div class="summary-label">Business mi</div></div><div class="summary-div"></div><div><div class="summary-val" style="color:#8b5cf6">'+s.personal.toFixed(0)+'</div><div class="summary-label">Personal mi</div></div><div class="summary-div"></div><div><div class="summary-val">'+s.total.toFixed(0)+'</div><div class="summary-label">Total mi</div></div></div></div><div class="card"><div style="font-size:15px;font-weight:600;color:#94a3b8;margin-bottom:12px">Breakdown</div><div class="breakdown-bar"><div class="bar-seg" style="flex:'+(s.business||0.01)+';background:linear-gradient(90deg,#3b82f6,#60a5fa);border-radius:13px 0 0 13px"></div><div class="bar-seg" style="flex:'+(s.personal||0.01)+';background:linear-gradient(90deg,#8b5cf6,#a78bfa)"></div><div class="bar-seg" style="flex:'+(s.unclassified||0.01)+';background:linear-gradient(90deg,#f59e0b,#fbbf24);border-radius:0 13px 13px 0"></div></div><div class="legend-row"><div class="legend-item"><div class="legend-dot" style="background:#3b82f6"></div>Business '+bp+'%</div><div class="legend-item"><div class="legend-dot" style="background:#8b5cf6"></div>Personal '+pp+'%</div><div class="legend-item"><div class="legend-dot" style="background:#f59e0b"></div>Other '+up+'%</div></div></div><div class="deduction-card"><div class="deduction-title">Tax Deduction Estimate</div><div class="deduction-value">$'+s.deduction.toFixed(2)+'</div><div class="deduction-meta">'+s.business.toFixed(1)+' business miles x $'+IRS+'/mi (2026 IRS rate)</div></div><div class="card"><div style="font-size:15px;font-weight:600;color:#94a3b8;margin-bottom:16px">Last 7 Days</div><div class="chart-row">'+wd.map(d=>'<div class="chart-col"><div class="chart-bars"><div class="chart-bar-biz" style="height:'+(d.b/mx*100)+'%;min-height:'+(d.b>0?3:0)+'px"></div><div class="chart-bar-per" style="height:'+(d.p/mx*100)+'%;min-height:'+(d.p>0?3:0)+'px"></div></div><span class="chart-label">'+d.label+'</span></div>').join('')+'</div></div>'}
const saved=load();trips=saved&&saved.length>0?saved:sampleTrips();save();renderAll();
</script>
</body>
</html>
